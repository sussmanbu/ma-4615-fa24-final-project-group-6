<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Here we provide a detailed analysis using more sophisticated statistics techniques.">

<title>MA 415 Final Project Group 6 - Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MA 415 Final Project Group 6</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./big_picture.html"> 
<span class="menu-text">Big Picture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./analysis.html" aria-current="page"> 
<span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html"> 
<span class="menu-text">Data</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#motivation-behind-data-analysis" id="toc-motivation-behind-data-analysis" class="nav-link" data-scroll-target="#motivation-behind-data-analysis">Motivation Behind Data Analysis</a></li>
  <li><a href="#data-findings" id="toc-data-findings" class="nav-link" data-scroll-target="#data-findings">Data Findings</a>
  <ul class="collapse">
  <li><a href="#racial-disparities-in-health-mental-and-physical-status" id="toc-racial-disparities-in-health-mental-and-physical-status" class="nav-link" data-scroll-target="#racial-disparities-in-health-mental-and-physical-status">Racial Disparities in Health (mental and physical status)</a></li>
  <li><a href="#education-and-loneliness-level" id="toc-education-and-loneliness-level" class="nav-link" data-scroll-target="#education-and-loneliness-level">Education and Loneliness Level</a></li>
  <li><a href="#state-income-and-state-diversity-ratio" id="toc-state-income-and-state-diversity-ratio" class="nav-link" data-scroll-target="#state-income-and-state-diversity-ratio">State Income and State Diversity Ratio</a></li>
  <li><a href="#health-status-and-affordability-of-medical-costs" id="toc-health-status-and-affordability-of-medical-costs" class="nav-link" data-scroll-target="#health-status-and-affordability-of-medical-costs">Health Status and Affordability of Medical Costs</a></li>
  <li><a href="#past-exposure-and-current-consumption" id="toc-past-exposure-and-current-consumption" class="nav-link" data-scroll-target="#past-exposure-and-current-consumption">Past Exposure and Current Consumption</a></li>
  </ul></li>
  <li><a href="#rubric-on-this-page" id="toc-rubric-on-this-page" class="nav-link" data-scroll-target="#rubric-on-this-page">Rubric: On this page</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis</h1>
</div>

<div>
  <div class="description">
    Here we provide a detailed analysis using more sophisticated statistics techniques.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Our physical and mental health outcomes are deeply influenced by a combination of factors, including our environments, access to health insurance, socioeconomic status, and lived experiences. These elements work together to shape our overall well-being, and current habits, and determine the opportunities and challenges we face in maintaining good health.</p>
</section>
<section id="motivation-behind-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="motivation-behind-data-analysis">Motivation Behind Data Analysis</h2>
<p>Our proposed thesis is that better socioeconomic status and social determinants correlate to better mental and physical health. We aim to assess the relationships between socioeconomic factors and different mental and physical health outcomes.</p>
<p>Some questions that are explored include: How are education rates and loneliness rates related? Can we accurately predict the relationship between health status and affording medical costs? Does childhood exposure to negative social experiences affect current behavior? How does mental and physical health vary across different racial groups?</p>
</section>
<section id="data-findings" class="level2">
<h2 class="anchored" data-anchor-id="data-findings">Data Findings</h2>
<section id="racial-disparities-in-health-mental-and-physical-status" class="level3">
<h3 class="anchored" data-anchor-id="racial-disparities-in-health-mental-and-physical-status">Racial Disparities in Health (mental and physical status)</h3>
<p><img src="images/Race_health.png" class="img-fluid"></p>
<p>This visualization examines racial disparities in mental health by displaying the average number of days individuals reported experiencing poor mental health. The x-axis represents the number of days, and the y-axis represents different racial categories. The bars are arranged in descending order, with each bar representing the average number of days of mental health distress for each racial group. The data reveals the following patterns. Multiracial individuals report the highest average, around 5.5 days of mental health unwellness. American Indian or Alaskan Native individuals follow closely with an average of about 5 days. Native Hawaiian or Other Pacific Islander and Hispanic individuals report nearly identical averages of about 4.8 days. The Other category is slightly above 4 days on average. Black individuals report an average of about 4 days. White individuals experience about 3.5 days on average. Asian individuals report the lowest, with an average of around 2.2 days. Multiracial and American Indian or Alaskan Native individuals, report substantially higher levels of mental health challenges compared to others.</p>
<p><img src="images/race_physical.png" class="img-fluid"></p>
<p>In this bar graph, we explored racial disparities in physical health by measuring the average number of days individuals report feeling physically unwell across different racial demographics. The bars are sorted in descending order, highlighting the racial groups with the highest to lowest average days of physical health unwellness. American Indian or Alaskan Native individuals report the highest average, just above 4.3 days. Multiracial individuals follow closely with an average of nearly 3.7 days. Native Hawaiian or Pacific Islander individuals report an average of about 3.4 days. The Other category reports just above 3.3 days on average. Hispanic individuals have an average of slightly over 3 days. White individuals report an average of 2.7 days. Black individuals have an average of approximately 2.6 days. Asian individuals report the lowest, with an average of just over 2 days. American Indian or Alaskan Native individuals experience the highest average number of days feeling physically unwell, while Asian individuals report the fewest.</p>
</section>
<section id="education-and-loneliness-level" class="level3">
<h3 class="anchored" data-anchor-id="education-and-loneliness-level">Education and Loneliness Level</h3>
<p><img src="images/education_loneliness.png" class="img-fluid"> Across all racial groups, the percentage of survey respondents reporting feelings of loneliness tends to decrease as education level increases. Since loneliness is a key predictor of mental health, a Poisson regression model is used to investigate the relationship between state income and loneliness (which was transformed from a categorical variable to a binary variable) on the number of days of mental health unwell last month. It indicates that the predicted number of days with poor mental health per month is 543.45% higher for individuals who feel lonely compared to those who do not. Additionally, there are state-level variations: people living in wealthier states have 1.61% more predicted days of poor mental health per month than those in less affluent states.</p>
<p>These findings suggest that socioeconomic factors, such as education level, correlate mental health through their impact on loneliness. This relationship is likely because respondents with higher education levels often report higher incomes and better life satisfaction, which are associated with lower levels of loneliness and, in turn, better mental health outcomes.</p>
</section>
<section id="state-income-and-state-diversity-ratio" class="level3">
<h3 class="anchored" data-anchor-id="state-income-and-state-diversity-ratio">State Income and State Diversity Ratio</h3>
<p><img src="images/ratio_state_income.png" class="img-fluid"></p>
</section>
<section id="health-status-and-affordability-of-medical-costs" class="level3">
<h3 class="anchored" data-anchor-id="health-status-and-affordability-of-medical-costs">Health Status and Affordability of Medical Costs</h3>
<p><img src="images/medical_cost_health.png" class="img-fluid"></p>
<p>Building on this, we developed a logistic regression model to predict the affordability of medical costs based on health status. The model reveals that as health status improves, the predicted probability of affording medical costs increases. The coefficient for health status in the regression model is 0.56291, indicating that a one-unit increase in health status leads to a significant increase in the log-odds of affording medical costs. By converting this coefficient to a percentage change, we find that a better health status corresponds to a 75.58% higher likelihood of being able to afford medical costs.</p>
<p>The plot clearly illustrates this trend, with the red line showing the relationship between health status and predicted affordability, while the blue points represent individual predictions. It reveals that individuals with poorer health are less likely to afford medical costs, whereas those in better health are more likely to do so. This supports our thesis that better health status correlates with better access to healthcare resources, emphasizing the impact of social determinants on individuals’ ability to manage medical expenses and their overall well-being.</p>
</section>
<section id="past-exposure-and-current-consumption" class="level3">
<h3 class="anchored" data-anchor-id="past-exposure-and-current-consumption">Past Exposure and Current Consumption</h3>
<p><img src="images/marijuana.png" class="img-fluid"> Respondents were asked to report the number of days they used marijuana over the past 30 days. The box plot illustrates the distribution of marijuana usage frequencies based on childhood exposure to specific conditions or behaviors. The y-axis represents the number of days marijuana was used in a 30-day period, while the x-axis indicates binary exposure levels: “Yes” for respondents who were exposed to a specific condition or behavior during childhood, and “No” for those who were not. The graph features three color-coded box plots, each representing a different type of exposure. The first plot (teal) corresponds to exposure to someone who was depressed, mentally ill, or suicidal. The second plot (yellow) represents exposure to someone who used illegal street drugs or abused prescription medications. The third plot (purple) captures exposure to someone who was a drinker or alcoholic.</p>
<p>Each box plot summarizes the variation in marijuana usage frequency across exposure levels. Mean values are represented by the red dots present in the images. According to the data, the mean marijuana frequency across all exposure type is larger for respondents who indicated that they were exposed. For alcohol exposure, the mean is 14.59 for respondents who were not exposed and 16.43 for respondents who were exposed. For depression exposure, the mean for respondents who were not exposed is 14.2 and the mean for respondents who were exposed is 16.78. For dug exposure, the mean for respondents who weren’t exposed is 14.77, and he mean for respondents who were exposed is 17.03. Median values also follow a similar pattern with respondents exposed to a condition or behavior, witnessing higher median values. For instance, the median value for respondents who were not exposed to depression is 10 in contrast the median value for exposed respondents is 20. For alcohol exposure type the median is 12 for those who weren’t exposed and 15 for those who were. For the drug exposure category, the median is 12 for respondents who weren’t exposed and 20 for those who were exsposed Across all groups, the minimum number of usage days is consistent at 1 day. The maximum usage is 30 days across all groups, showing that some individuals reported daily marijuana use regardless of exposure type. There is substantial variability indicated by the box heights and whiskers in the usage frequency, particularly among exposed individuals.</p>
<p><img src="images/statsofversion.png" class="img-fluid"> An ANOVA test was performed to assess whether the differences in results between the “Yes” and “No” options were statistically significant.</p>
<p><img src="images/anovatestmarijuana.png" class="img-fluid"></p>
<p>The P-value (2.22e-07) and F-value (26.938) suggest a highly significant effect of exposure level on marijuana usage. Respondents exposed to these conditions in childhood are more likely to show differences in marijuana usage frequency. The P-value (1.000) and F-value (0.000) indicate no significant effect of exposure type on marijuana usage. The P-value (0.759) and F-value (0.276) indicate no significant interaction between exposure type and exposure level. In other words, the effect of exposure level is consistent across all types of exposure. Exposure type alone does not significantly influence marijuana usage, but exposure level is a strong predictor. Additionally, there is no significant interaction between exposure type and exposure level. This suggests that exposure to conditions in childhood has a significant effect on their marijuana usage, regardless of the specific type of exposure. Thus, we emphasize that exposure to these behaviors during childhood has a significant likelihood of shaping current behavioral patterns, particularly concerning health and the impact of exposure to relatively unhealthy conditions.</p>
<p>To examine the relationship between marijuana consumption and physical health, a logistic regression model was employed to assess how marijuana consumption frequency and the inability to pay bills impact physical health status. Physical health status, which was a categorical variable, was transformed into a binary variable, with “0” representing good health and “1” representing poor health. The regression analysis reveals that a one-unit increase in marijuana consumption is associated with a 4.23% increase in the likelihood of experiencing poor health. Additionally, financial status plays a significant role: individuals unable to afford monthly bills, such as rent, are 169.16% more likely to report poor health compared to those who can afford their bills. These findings underscore that, beyond medical costs, financial stress is strongly correlated with health outcomes. Overall, the results highlight the broader link between higher socioeconomic status and better physical health.</p>
<hr>
</section>
</section>
<section id="rubric-on-this-page" class="level2">
<h2 class="anchored" data-anchor-id="rubric-on-this-page">Rubric: On this page</h2>
<p>You will</p>
<ul>
<li>Introduce what motivates your Data Analysis (DA)
<ul>
<li>Which variables and relationships are you most interested in?</li>
<li>What questions are you interested in answering?</li>
<li>Provide context for the rest of the page. This will include figures/tables that illustrate aspects of the data of your question.</li>
</ul></li>
<li>Modeling and Inference
<ul>
<li>The page will include some kind of formal statistical model. This could be a linear regression, logistic regression, or another modeling framework.</li>
<li>Explain the ideas and techniques you used to choose the predictors for your model. (Think about including interaction terms and other transformations of your variables.)</li>
<li>Describe the results of your modelling and make sure to give a sense of the uncertainty in your estimates and conclusions.</li>
</ul></li>
<li>Explain the flaws and limitations of your analysis
<ul>
<li>Are there some assumptions that you needed to make that might not hold? Is there other data that would help to answer your questions?</li>
</ul></li>
<li>Clarity Figures
<ul>
<li>Are your figures/tables/results easy to read, informative, without problems like overplotting, hard-to-read labels, etc?</li>
<li>Each figure should provide a key insight. Too many figures or other data summaries can detract from this. (While not a hard limit, around 5 total figures is probably a good target.)</li>
<li>Default <code>lm</code> output and plots are typically not acceptable.</li>
</ul></li>
<li>Clarity of Explanations
<ul>
<li>How well do you explain each figure/result?</li>
<li>Do you provide interpretations that suggest further analysis or explanations for observed phenomenon?</li>
</ul></li>
<li>Organization and cleanliness.
<ul>
<li>Make sure to remove excessive warnings, hide most or all code, organize with sections or multiple pages, use bullets, etc.</li>
<li>This page should be self-contained, i.e.&nbsp;provide a description of the relevant data.</li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/sussmanbu\.github\.io\/ma-4615-fa24-final-project-group-6\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>